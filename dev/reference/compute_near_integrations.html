<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='
This function scans the input integration matrix to detect eventual
integration sites that are too "near" to each other and merges them
into single integration sites adjusting their values if needed.'><title>Scans input matrix to find and merge near integration sites. — compute_near_integrations • ISAnalytics</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Scans input matrix to find and merge near integration sites. — compute_near_integrations"><meta property="og:description" content='
This function scans the input integration matrix to detect eventual
integration sites that are too "near" to each other and merges them
into single integration sites adjusting their values if needed.'><meta property="og:image" content="https://calabrialab.github.io/ISAnalytics/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ISAnalytics</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.11.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/ISAnalytics.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/workflow_start.html">Setting up the workflow and first steps</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="nav-link" href="https://calabrialab.github.io/ISAnalytics/">
    <span class="fas fa fas fa-code-branch"></span>
     
    RELEASE
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/calabrialab/ISAnalytics/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Scans input matrix to find and merge near integration sites.</h1>
      <small class="dont-index">Source: <a href="https://github.com/calabrialab/ISAnalytics/blob/HEAD/R/recalibration-functions.R" class="external-link"><code>R/recalibration-functions.R</code></a></small>
      <div class="d-none name"><code>compute_near_integrations.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a>
This function scans the input integration matrix to detect eventual
integration sites that are too "near" to each other and merges them
into single integration sites adjusting their values if needed.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">compute_near_integrations</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  is_identity_tags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chromosome"</span>, <span class="st">"is_strand"</span><span class="op">)</span>,</span>
<span>  keep_criteria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max_value"</span>, <span class="st">"keep_first"</span><span class="op">)</span>,</span>
<span>  value_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"seqCount"</span>, <span class="st">"fragmentEstimate"</span><span class="op">)</span>,</span>
<span>  max_value_column <span class="op">=</span> <span class="st">"seqCount"</span>,</span>
<span>  sample_id_column <span class="op">=</span> <span class="fu"><a href="pcr_id_column.html">pcr_id_column</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  additional_agg_lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="fu"><a href="default_rec_agg_lambdas.html">default_rec_agg_lambdas</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  max_workers <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  map_as_file <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  file_path <span class="op">=</span> <span class="fu"><a href="default_report_path.html">default_report_path</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  strand_specific <span class="op">=</span> <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecated.html" class="external-link">deprecated</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>An integration matrix</p></dd>


<dt>threshold</dt>
<dd><p>A single integer that represents an absolute
number of bases for which two integrations are considered distinct.
If the threshold is set to 3 it means, provided fields <code>chr</code>
and <code>strand</code> are the same, integrations sites
which have at least 3 bases in between them are
considered distinct.</p></dd>


<dt>is_identity_tags</dt>
<dd><p>Character vector of tags that identify the
integration event as distinct (except for <code>"locus"</code>). See details.</p></dd>


<dt>keep_criteria</dt>
<dd><p>While scanning, which integration should be kept?
The 2 possible choices for this parameter are:</p><ul><li><p>"max_value": keep the integration site which has the highest value
(and collapse other values on that integration).</p></li>
<li><p>"keep_first": keeps the first integration</p></li>
</ul></dd>


<dt>value_columns</dt>
<dd><p>Character vector, contains the names of the numeric
experimental columns</p></dd>


<dt>max_value_column</dt>
<dd><p>The column that has to be considered for
searching the maximum value</p></dd>


<dt>sample_id_column</dt>
<dd><p>The name of the column containing the sample
identifier</p></dd>


<dt>additional_agg_lambda</dt>
<dd><p>A named list containing aggregating functions
for additional columns. See details.</p></dd>


<dt>max_workers</dt>
<dd><p>Maximum parallel workers allowed</p></dd>


<dt>map_as_file</dt>
<dd><p>Produce recalibration map as a .tsv file?</p></dd>


<dt>file_path</dt>
<dd><p>String representing the path were the file will be
saved. Must be a folder. Relevant only if <code>map_as_file</code> is
<code>TRUE</code>.</p></dd>


<dt>strand_specific</dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated" class="external-link"><img src="figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a>
Deprecated, use <code>is_identity_tags</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An integration matrix with same or less number of rows</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    
<div class="section">
<h3 id="the-concept-of-near-">The concept of "near"<a class="anchor" aria-label="anchor" href="#the-concept-of-near-"></a></h3>


<p>An integration event is uniquely identified by all fields specified in
the <code><a href="mandatory_IS_vars.html">mandatory_IS_vars()</a></code> look-up table. It can happen to find IS that
are formally distinct (different combination of values in the fields),
but that should not considered distinct in practice,
since they represent the same integration event - this may be due
to artefacts at the putative locus of the IS in the merging of multiple
sequencing libraries.</p>
<p>We say that an integration event IS1 is near to another integration event
IS2 if the absolute difference of their loci is strictly lower than the
set <code>threshold</code>.</p>
</div>

<div class="section">
<h3 id="the-is-identity">The IS identity<a class="anchor" aria-label="anchor" href="#the-is-identity"></a></h3>


<p>There is also another aspect to be considered. Since the algorithm
is based on a sliding window mechanism, on which groups of IS should we
set and slide the window?</p>
<p>By default, we have 3 fields in the <code><a href="mandatory_IS_vars.html">mandatory_IS_vars()</a></code>:
chr, integration_locus, strand, and we assume that all the fields
contribute to the identity of the IS. This means that IS1 and IS2 can be
compared only if they have the same chromosome and the same strand.
However, if we would like to exclude the strand of the integration from
our considerations then IS1 and IS2 can be selected from all the events
that fall on the same chromosome. A practical example:</p>
<p>IS1 = <code>(chr = "1", strand = "+", integration_locus = 14568)</code></p>
<p>IS2 = <code>(chr = "1", strand = "-", integration_locus = 14567)</code></p>
<p>if <code>is_identity_tags = c("chromosome", "is_strand")</code> IS1 and IS2 are
considered distinct because they differ in strand, therefore no correction
will be applied to loci of either of the 2.
If <code>is_identity_tags = c("chromosome")</code> then IS1 and IS2 are considered
near, because the strand is irrelevant, hence one of the 2 IS will change
locus.</p>
</div>

<div class="section">
<h3 id="aggregating-near-is">Aggregating near IS<a class="anchor" aria-label="anchor" href="#aggregating-near-is"></a></h3>


<p>IS that fall in the same interval are evaluated according to the
criterion selected - if recalibration is necessary, rows with the same
sample ID are aggregated in a single row with a quantification value that
is the sum of all the merged rows.</p>
<p>If the input integration matrix contains annotation columns, that is
additional columns that are not</p><ul><li><p>part of the mandatory IS vars (see <code><a href="mandatory_IS_vars.html">mandatory_IS_vars()</a></code>)</p></li>
<li><p>part of the annotation IS vars (see <code><a href="mandatory_IS_vars.html">annotation_IS_vars()</a></code>)</p></li>
<li><p>the sample identifier column</p></li>
<li><p>the quantification column</p></li>
</ul><p>it is possible to specify how they should be aggregated.
Defaults are provided for each column type (character, integer, numeric...),
but custom functions can be specified as a named list, where names are
column names in <code>x</code> and values are functions to be applied.
NOTE: functions must be purrr-style lambdas and they must perform some kind
of aggregating operation, aka they must take a vector as input and return
a single value. The type of the output should match the type of the
target column. If you specify custom lambdas, provide defaults in the
special element <code>.defaults</code>.
Example:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  numeric_col <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>,</span>
<span>  char_col <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.x</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>  .defaults <span class="op">=</span> <span class="fu"><a href="../reference/default_rec_agg_lambdas.html">default_rec_agg_lambdas</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre><p></p></div>
</div>

    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>We do recommend to use this function in combination with
<a href="comparison_matrix.html">comparison_matrix</a> to automatically perform re-calibration on
all quantification matrices.</p>
    </div>
    <div class="section level2">
    <h2 id="required-tags">Required tags<a class="anchor" aria-label="anchor" href="#required-tags"></a></h2>
    

<p>The function will explicitly check for the presence of these tags:</p><ul><li><p>chromosome</p></li>
<li><p>locus</p></li>
<li><p>is_strand</p></li>
<li><p>gene_symbol</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Data cleaning and pre-processing: 
<code><a href="aggregate_metadata.html">aggregate_metadata</a>()</code>,
<code><a href="aggregate_values_by_key.html">aggregate_values_by_key</a>()</code>,
<code><a href="default_meta_agg.html">default_meta_agg</a>()</code>,
<code><a href="outlier_filter.html">outlier_filter</a>()</code>,
<code><a href="outliers_by_pool_fragments.html">outliers_by_pool_fragments</a>()</code>,
<code><a href="purity_filter.html">purity_filter</a>()</code>,
<code><a href="realign_after_collisions.html">realign_after_collisions</a>()</code>,
<code><a href="remove_collisions.html">remove_collisions</a>()</code>,
<code><a href="threshold_filter.html">threshold_filter</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"integration_matrices"</span>, package <span class="op">=</span> <span class="st">"ISAnalytics"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu">compute_near_integrations</span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="va">integration_matrices</span>, map_as_file <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rec</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   chr   integration_locus strand GeneName GeneStrand CompleteAmplificationID    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 1               8<span style="text-decoration: underline;">607</span>357 +      RERE     -          PJ01_POOL01_LTR27LC94_PT00…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> 1               8<span style="text-decoration: underline;">607</span>357 +      RERE     -          PJ01_POOL01_LTR83LC46_PT00…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> 1               8<span style="text-decoration: underline;">607</span>357 +      RERE     -          PJ01_POOL01_LTR83LC66_PT00…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> 1               8<span style="text-decoration: underline;">607</span>357 +      RERE     -          PJ01_POOL01_LTR53LC32_PT00…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> 1               8<span style="text-decoration: underline;">607</span>357 +      RERE     -          PJ01_POOL02_LTR87LC74_PT00…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> 1               8<span style="text-decoration: underline;">850</span>362 +      RERE     -          PJ01_POOL03_LTR51LC86_PT00…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2 more variables: seqCount &lt;dbl&gt;, fragmentEstimate &lt;dbl&gt;</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Giulia Pais, Andrea Calabria, Giulio Spinozzi.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>


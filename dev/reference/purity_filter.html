<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="
Filter that targets possible contamination between cell lines based on
a numeric quantification (likely abundance or sequence count)."><title>Filter integration sites based on purity. — purity_filter • ISAnalytics</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter integration sites based on purity. — purity_filter"><meta property="og:description" content="
Filter that targets possible contamination between cell lines based on
a numeric quantification (likely abundance or sequence count)."><meta property="og:image" content="https://calabrialab.github.io/ISAnalytics/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ISAnalytics</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.5.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/ISAnalytics.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/workflow_start.html">Setting up the workflow and first steps</a>
    <a class="dropdown-item" href="../articles/sharing_analyses.html">Sharing analyses with ISAnalytics</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="nav-link" href="https://calabrialab.github.io/ISAnalytics/">
    <span class="fas fa fas fa-code-branch"></span>
     
    RELEASE
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/calabrialab/ISAnalytics/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Filter integration sites based on purity.</h1>
      <small class="dont-index">Source: <a href="https://github.com/calabrialab/ISAnalytics/blob/HEAD/R/purity-filter.R" class="external-link"><code>R/purity-filter.R</code></a></small>
      <div class="d-none name"><code>purity_filter.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a>
Filter that targets possible contamination between cell lines based on
a numeric quantification (likely abundance or sequence count).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">purity_filter</span><span class="op">(</span>
  <span class="va">x</span>,
  lineages <span class="op">=</span> <span class="fu"><a href="blood_lineages_default.html">blood_lineages_default</a></span><span class="op">(</span><span class="op">)</span>,
  aggregation_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SubjectID"</span>, <span class="st">"CellMarker"</span>, <span class="st">"Tissue"</span>, <span class="st">"TimePoint"</span><span class="op">)</span>,
  group_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CellMarker"</span>, <span class="st">"Tissue"</span><span class="op">)</span>,
  selected_groups <span class="op">=</span> <span class="cn">NULL</span>,
  join_on <span class="op">=</span> <span class="st">"CellMarker"</span>,
  min_value <span class="op">=</span> <span class="fl">3</span>,
  impurity_threshold <span class="op">=</span> <span class="fl">10</span>,
  by_timepoint <span class="op">=</span> <span class="cn">TRUE</span>,
  timepoint_column <span class="op">=</span> <span class="st">"TimePoint"</span>,
  value_column <span class="op">=</span> <span class="st">"seqCount_sum"</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>An aggregated integration matrix, obtained via
<code><a href="aggregate_values_by_key.html">aggregate_values_by_key()</a></code></p></dd>
<dt>lineages</dt>
<dd><p>A data frame containing cell lineages information</p></dd>
<dt>aggregation_key</dt>
<dd><p>The key used for aggregating <code>x</code></p></dd>
<dt>group_key</dt>
<dd><p>A character vector of column names for re-aggregation.
Column names must be either in <code>x</code> or in <code>lineages</code>. See details.</p></dd>
<dt>selected_groups</dt>
<dd><p>Either NULL, a character vector or a
data frame for group selection. See details.</p></dd>
<dt>join_on</dt>
<dd><p>Common columns to perform a join operation on</p></dd>
<dt>min_value</dt>
<dd><p>A minimum value to filter the input matrix. Integrations
with a value strictly lower than <code>min_value</code> are excluded (dropped) from
the output.</p></dd>
<dt>impurity_threshold</dt>
<dd><p>The ratio threshold for impurity in groups</p></dd>
<dt>by_timepoint</dt>
<dd><p>Should filtering be applied on each time point? If
<code>FALSE</code>, all time points are merged together</p></dd>
<dt>timepoint_column</dt>
<dd><p>Column in <code>x</code> containing the time point</p></dd>
<dt>value_column</dt>
<dd><p>Column in <code>x</code> containing the numeric
quantification of interest</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    
<div class="section">
<h3 id="setting-input-arguments">Setting input arguments<a class="anchor" aria-label="anchor" href="#setting-input-arguments"></a></h3>


<p>The input matrix can be re-aggregated with the provided <code>group_key</code>
argument. This key contains the names of the columns to group on
(besides the columns holding genomic coordinates of the integration
sites) and must be contained in at least one of <code>x</code> or <code>lineages</code>
data frames. If the key is not found only in <code>x</code>, then a join operation
with the <code>lineages</code> data frame is performed on the common column(s)
<code>join_on</code>.</p>
</div>

<div class="section">
<h3 id="group-selection">Group selection<a class="anchor" aria-label="anchor" href="#group-selection"></a></h3>


<p>It is possible for the user to specify on which groups the logic of the
filter should be applied to. For example: if we have
<code>group_key = c("HematoLineage")</code> and we set
<code>selected_groups = c("CD34", "Myeloid","Lymphoid")</code>
it means that a single integration will be evaluated for the filter only
for groups that have the values of "CD34", "Myeloid" and "Lymphoid" in
the "HematoLineage" column.
If the same integration is present in other groups it is
kept as it is. <code>selected_groups</code> can be set to <code>NULL</code> if we want
the logic to apply to every group present in the data frame,
it can be set as a simple character vector as the example above if
the group key has length 1 (and there is no need to filter on time point).
If the group key is longer than 1 then the filter is applied only on the
first element of the key.</p>
<p>If a more refined selection on groups is needed, a data frame can
be provided instead:</p><div class="sourceCode"><pre><code><span class="va">group_key</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CellMarker"</span>, <span class="st">"Tissue"</span><span class="op">)</span>
<span class="va">selected_groups</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span>
<span class="op">~</span> <span class="va">CellMarker</span>, <span class="op">~</span> <span class="va">Tissue</span>,
<span class="st">"CD34"</span>, <span class="st">"BM"</span>,
<span class="st">"CD14"</span>, <span class="st">"BM"</span>,
<span class="st">"CD14"</span>, <span class="st">"PB"</span>
<span class="op">)</span></code></pre></div>

<p>Columns in the data frame should be the same as group key (plus,
eventually, the time point column). In this example only those groups
identified by the rows in the provided data frame are processed.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Data cleaning and pre-processing: 
<code><a href="aggregate_metadata.html">aggregate_metadata</a>()</code>,
<code><a href="aggregate_values_by_key.html">aggregate_values_by_key</a>()</code>,
<code><a href="compute_near_integrations.html">compute_near_integrations</a>()</code>,
<code><a href="default_meta_agg.html">default_meta_agg</a>()</code>,
<code><a href="outlier_filter.html">outlier_filter</a>()</code>,
<code><a href="outliers_by_pool_fragments.html">outliers_by_pool_fragments</a>()</code>,
<code><a href="realign_after_collisions.html">realign_after_collisions</a>()</code>,
<code><a href="remove_collisions.html">remove_collisions</a>()</code>,
<code><a href="threshold_filter.html">threshold_filter</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"integration_matrices"</span>, package <span class="op">=</span> <span class="st">"ISAnalytics"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"association_file"</span>, package <span class="op">=</span> <span class="st">"ISAnalytics"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">aggreg</span> <span class="op">&lt;-</span> <span class="fu"><a href="aggregate_values_by_key.html">aggregate_values_by_key</a></span><span class="op">(</span></span>
<span class="r-in">    x <span class="op">=</span> <span class="va">integration_matrices</span>,</span>
<span class="r-in">    association_file <span class="op">=</span> <span class="va">association_file</span>,</span>
<span class="r-in">    value_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"seqCount"</span>, <span class="st">"fragmentEstimate"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="va">filtered_by_purity</span> <span class="op">&lt;-</span> <span class="fu">purity_filter</span><span class="op">(</span></span>
<span class="r-in">    x <span class="op">=</span> <span class="va">aggreg</span>,</span>
<span class="r-in">    value_column <span class="op">=</span> <span class="st">"seqCount_sum"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">filtered_by_purity</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 9</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   chr   integration_locus strand GeneName GeneStrand TimePoint CellMarker Tissue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 1              27<span style="text-decoration: underline;">058</span>748 -      ARID1A   +          0060      MNC        BM    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> 1              89<span style="text-decoration: underline;">337</span>032 +      GTF2B    -          0360      MNC        BM    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> 1              89<span style="text-decoration: underline;">337</span>032 +      GTF2B    -          0360      MNC        PB    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> 10             74<span style="text-decoration: underline;">765</span>793 -      P4HA1    -          0360      MNC        BM    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> 10             74<span style="text-decoration: underline;">765</span>793 -      P4HA1    -          0360      MNC        PB    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> 11              3<span style="text-decoration: underline;">899</span>973 +      STIM1    +          0090      MNC        BM    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 1 more variable: Value &lt;dbl&gt;</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Andrea Calabria, Giulio Spinozzi, Giulia Pais.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer></div>

  

  

  </body></html>

